<script>
  window.onload = function() {
    // Get the URL parameters
    var params = new URLSearchParams(window.location.search);

    // Get the 'error' parameter
    var error = params.get('error');

    // If there's an error message, display it
    if (error) {
      var errorDiv = document.createElement('div');
      errorDiv.textContent = 'Error: ' + decodeURIComponent(error);
      errorDiv.style.color = 'red'; // Make the error message stand out
      document.querySelector('.form-column').prepend(errorDiv); // Insert the error message at the top of the form column
    }
  };
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('contactForm');
    const formStatus = document.getElementById('formStatus');
    
    // Add submission tracking
    const submissionCount = parseInt(localStorage.getItem('formSubmissionCount') || '0');
    const lastSubmitTime = localStorage.getItem('lastSubmitTime');
    if (lastSubmitTime && (Date.now() - parseInt(lastSubmitTime)) > 86400000) {
        localStorage.setItem('formSubmissionCount', '0');
    }

    // Track suspicious activity
    let hasSubmittedLink = false;
    let attempts = 0;

    form.addEventListener('submit', async function (event) {
        event.preventDefault();

        // Enhanced Validation
        const firstName = form.first_name.value.trim();
        const lastName = form.last_name.value.trim();
        const email = form.email.value.trim();
        const comment = form.comment.value.trim();
        let errors = {};

        // Check submission limits
        if (submissionCount >= 5) {
            showError("Maximum daily submission limit reached. Please try again tomorrow.");
            return;
        }

        // Check suspicious activity
        if (hasSubmittedLink && attempts > 1) {
            showError("You have been temporarily blocked due to suspicious activity.");
            return;
        }

        // Required fields validation
        if (!firstName) errors.firstName = "First name is required";
        if (!lastName) errors.lastName = "Last name is required";
        if (!email) errors.email = "Email is required";
        if (!comment) errors.comment = "Message is required";
        
        // Enhanced message validation
        if (comment.length < 10) {
            errors.comment = "Message must be at least 10 characters long";
        }
        
        // Link detection
        if (containsLinks(comment)) {
            errors.comment = "Please do not include links in your message";
            hasSubmittedLink = true;
            attempts++;
            showError(errors.comment);
            return;
        }

        // Email detection in message
        if (containsEmails(comment)) {
            errors.comment = "Please do not include email addresses in the message field";
            showError(errors.comment);
            return;
        }

        // Email format validation
        if (email && !validateEmail(email)) {
            errors.email = "Invalid email format";
        }

        // Check if there are any errors
        if (Object.keys(errors).length > 0) {
            const errorMessage = Object.values(errors).join(", ");
            showError(errorMessage);
            return;
        }

        // Form submission
        const formData = new FormData(form);

        try {
            const response = await fetch(form.action, {
                method: form.method,
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            });

            if (response.ok) {
                // Update submission count
                const currentCount = parseInt(localStorage.getItem('formSubmissionCount') || '0');
                localStorage.setItem('formSubmissionCount', (currentCount + 1).toString());
                localStorage.setItem('lastSubmitTime', Date.now().toString());

                showSuccess("Thanks for your submission!");
                form.reset();
            } else {
                const data = await response.json();
                if (data.errors) {
                    showError(data.errors.map(error => error.message).join(", "));
                } else {
                    showError("Oops! There was a problem submitting your form");
                }
            }
        } catch (error) {
            showError("Oops! There was a problem submitting your form");
        }
    });

    // Helper Functions
    function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function containsLinks(text) {
        const linkPatterns = [
            /https?:\/\/[^\s]+/i,
            /www\.[^\s]+/i,
            /[^\s]+\.[a-z]{2,}/i
        ];
        return linkPatterns.some(pattern => pattern.test(text));
    }

    function containsEmails(text) {
        const emailPattern = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g;
        return emailPattern.test(text);
    }

    function showError(message) {
        formStatus.textContent = message;
        formStatus.style.color = "red";
    }

    function showSuccess(message) {
        formStatus.textContent = message;
        formStatus.style.color = "green";
    }
});
  </script> 


<script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('contactForm');
      const formStatus = document.getElementById('formStatus');

      form.addEventListener('submit', async function (event) {
        event.preventDefault();

        // Validation
        const name = form.name.value.trim();
        const email = form.email.value.trim();
        const comment = form.comment.value.trim();

        if (!name || !email) {
          formStatus.textContent = "Please fill out all required fields.";
          formStatus.style.color = "red";
          return;
        }

        if (!validateEmail(email)) {
          formStatus.textContent = "Invalid email format.";
          formStatus.style.color = "red";
          return;
        }

        // Form Data
        const formData = new FormData(form);

        // Submit the form
        try {
          const response = await fetch('/', {
            method: 'POST',
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams(formData).toString()
          });

          if (response.ok) {
            formStatus.textContent = "Thanks for your submission!";
            formStatus.style.color = "green";
            form.reset();
          } else {
            formStatus.textContent = "Oops! There was a problem submitting your form";
            formStatus.style.color = "red";
          }
        } catch (error) {
          formStatus.textContent = "Oops! There was a problem submitting your form";
          formStatus.style.color = "red";
        }
      });

      function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
      }
    });
  </script>

  <div class="form-column">
          <div class="contact-form">
            <form id="contactForm" name="contact" method="POST" data-netlify="true">
              <input type="hidden" name="form-name" value="contact">
              <input type="text" name="name" placeholder="Name" required>
              <input type="email" name="email" placeholder="Email" required>
              <textarea name="comment" placeholder="Comment" rows="4" required></textarea>
              <button type="submit" name="submit">Submit</button>
            </form>
            <p class="privacy-statement">Your personal information will never be shared.</p>
            <p id="formStatus"></p>
          </div>    
        </div>